matrix:
  include:
    - language: ruby
      cache: bundler
      rvm:
        - 2.4.1
      services:
        - mongodb
      before_install:
        - "find /home/travis/.rvm/rubies -wholename '*default/bundler-*.gemspec' -delete"
        - rvm @global do gem uninstall bundler -a -x -I || true
        - gem install bundler -v "< 2.0"
      script:
        - bundle exec rake
        - bundle exec rubocop
        - bundle exec bundle-audit check --update
    - language: ruby
      cache: bundler
      rvm:
        - 2.3.8
      services:
        - mongodb
      before_install:
        - "find /home/travis/.rvm/rubies -wholename '*default/bundler-*.gemspec' -delete"
        - rvm @global do gem uninstall bundler -a -x -I || true
        - gem install bundler -v "< 2.0"
      script:
        - bundle exec rake
        - bundle exec rubocop
        - bundle exec bundle-audit check --update
    - language: node_js
      before_install:
        - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.12.3
        - export PATH=$HOME/.yarn/bin:$PATH
      install:
        - npm install -g codecov
        - npm install -g istanbul
      node_js:
        - "node"
        - "lts/*"
      cache:
        directories:
          - "node_modules"
      script:
        - yarn install
        - yarn run lint
        - yarn run test
        - yarn audit
        - ./bin/validate_dist.sh
        - ./bin/validate_browser.sh
        - ./bin/validate_generator.sh
        - codecov
